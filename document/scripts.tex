\chapter{Scripts}
\label{scriptchapter}

A \defining{script} specifies an entry point for defining and running
a Scheme program.  A script specifies a set of libraries to import and
code to run.  Through the imported libraries, whether directly or the
transitive closure of importing, the script defines a complete Scheme
program.

Scripts follow the convention of many common platforms of accepting a
list of string \defining{command-line arguments} that may be used to
pass data to the script.  Moreover, a script can return an exact
integer specifying the script's \defining{exit value}.

\section{Script syntax}

A script is a delimited piece of text, typically a file, that follows
the following syntax:

\begin{grammar}
\meta{script header} \: \#! /usr/bin/env scheme-script
  \> \meta{linefeed}
  \> \meta{script substance}
\meta{script substance} \: \#!r6rs \meta{import form} \meta{script body}
  \> \| \meta{import form} \meta{script body}
\meta{import form} \: (import \arbno{\meta{import spec}})
\meta{script body} \: \arbno{\meta{script body form}} \meta{expression}
\meta{script body form} \: \meta{declaration}
\> \| \meta{definition}
\> \| \meta{expression}
\end{grammar}

\subsection{Script header}

The syntax given for \meta{script header} is the recommended syntax for 
portable scripts.  For maximum portability amongst Scheme implementations
and operating systems, the first line of a script should contain exactly 
the characters specified in the rule.  However, this line is only for use 
by operating systems, and implementations are required to ignore it.  
The use of alternative platform-specific script headers is therefore 
allowed, possibly at the expense of portability.

Implementations should provide an executable program named {\cf scheme-script}
which is capable of executing scripts on platforms where this makes
sense.  On most Unix-like systems, due to the 
use of the {\cf /usr/bin/env} trampoline, this program may itself be a shell 
script.

Most platforms require that scripts be marked as executable files, the 
details of which vary by platform and are beyond the scope of this report. 
Platforms which do not support the Unix-like script header syntax may need 
to use other mechanisms such as a file extension in order to associate a 
script with the {\cf scheme-script} executable.

\subsection{Script substance}

The rules for \meta{script substance} specify syntax at the form level.

The \meta{import form} is identical to the import clause in
libraries (see section~\ref{librarysyntaxsection}), 
and specifies a set of libraries to import.  A \meta{script
  body} is like a \meta{library body} (see
section~\ref{librarybodysection}), except that declarations,
definitions and expressions may occur in any order, and that the final
form of the script body must be an expression.  Thus, the syntax
specified by \meta{script body form} refers to the result of macro
expansion.

As with \hyper{library body}, a {\cf begin} form appearing in a
\hyper{script body} acts as a splicing form; see section~\ref{begin}.
In a \hyper{script body}, a {\cf begin} form may always appear without
operands.

\section{Script semantics}

A script is executed by treating the script similarly to a library, and
invoking it.  The semantics of a script body is explained by
translating it to a library body: All declarations at the script top
level are moved to the front, and apply to the entire script body.
Each expression \hyper{expression} that appears before definitions in
the script body is converted into a definition {\cf (define \hyper{identifier}
  \hyper{expression})} by choosing a fresh \hyper{identifier}.

A script may access its command-line arguments by calling the {\cf
  command-line-arguments} procedure (see
section~\ref{command-line-arguments}).  The final expression of a
script must return an exact integer, which becomes the exit value of
the script.  How that exit value is communicated to the environment is
implementation-specific.  When a script is invoked as a Unix or
Windows program, the exit value simply becomes the exit status of the
program.

If an exception with a {\cf\&serious} condition is raised during the
execution of the script, the default exception handler will behave as
described in section~\ref{exceptionssection}, and an
implementation-specific exit value will be communicated to the
environment.  On Unix, this value is according to the definition of
{\cf EX\_SOFTWARE} in the {\cf sysexits.h} header~\cite{srfi22}.

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "r6rs"
%%% End: 
