\section{Simple I/O}
\label{simpleiosection}

This section describes the \deflibrary{r6rs i/o simple} library, which
provides a somewhat more convenient interface for performing textual
I/O on ports.  This library implements most of the 
I/O procedures of the previous version of this report~\cite{R5RS}.

\begin{entry}{%
\proto{call-with-input-file}{ filename proc}{procedure}
\proto{call-with-output-file}{ filename proc}{procedure}}

\domain{\var{Proc} shall be a procedure accepting a single argument.}
These procedures open the file named by \var{filename} for input or
for output, with no specified file options, and call \var{proc} with
the obtained port as an argument.  If \var{proc} returns, then the
port is closed automatically and the values returned by \var{proc} are
returned. If \var{proc} does not return, then the port will not be
closed automatically, unless it is possible to prove that the port
will never again be used for an I/O operation.
\end{entry}

\begin{entry}{%
\rproto{input-port?}{ obj}{procedure}
\rproto{output-port?}{ obj}{procedure}}

These are the same as the {\cf input-port?} and {\cf output-port?}
procedures in the \library{r6rs i/o ports} library.
\end{entry}

\begin{entry}{%
\proto{current-input-port}{}{procedure}
\proto{current-output-port}{}{procedure}}

These return default ports for a input and output.  Normally, these
default ports are associated with standard input and standard output,
respectively, but can be dynamically re-assigned using the {\cf
  with-input-from-file} and {\cf with-output-to-file} procedures
described below.
\end{entry}

\begin{entry}{%
\proto{with-input-from-file}{ filename thunk}{procedure}
\proto{with-output-to-file}{ filename thunk}{procedure}}

\domain{\var{Thunk} shall be a procedure that takes no arguments.}  The
file is opened for input or output using empty file options, and
\var{thunk} is called with no arguments.  During the dynamic extent of
the call to \var{thunk}, the obtained port is made the value returned
by {\cf current-input-port} or {\cf current-output-port} procedures;
the previous default values are reinstated when the dynamic extent is
exited.  When \var{thunk} returns, the port is closed automatically,
and the previous values for {\cf current-input-port}.  The values
returned by \var{thunk} are returned.  If an escape procedure is used
to escape back into the call to \var{thunk} after \var{thunk} is
returned, the behavior is unspecified.
\end{entry}

\begin{entry}{%
\proto{open-input-file}{ filename}{procedure}}

This opens \var{filename} for input, with empty file options, and returns
the obtained port.
\end{entry}

\begin{entry}{%
\proto{open-output-file}{ filename}{procedure}}

This opens \var{filename} for output, with empty file options, and
returns the obtained port.
\end{entry}

\begin{entry}{%
\proto{close-input-port}{ input-port}{procedure}
\proto{close-output-port}{ output-port}{procedure}}

This closes \var{input-port} or \var{output-port}, respectively.
\end{entry}

\begin{entry}{%
\proto{read-char}{}{procedure}
\rproto{read-char}{ input-port}{procedure}}

This reads from \var{input-port} using the transcoder assocated with
it, blocking as necessary, until the complete encoding for a character
is available from input-port, or the bytes that are available cannot
be the prefix of any valid encoding, or an end of file is reached.

If a complete character is available before the next end of file, {\cf
  read-char} returns that character, and updates the input port to
point past the bytes that encoded that character. If an end of file is
reached before any bytes are read, then {\cf read-char} returns the
end-of-file object.

If \var{input-port} is omitted, it defaults to the value returned by
{\cf current-input-port}.
\end{entry}

\begin{entry}{%
\rproto{peek-char}{}{procedure}
\proto{peek-char}{ input-port}{procedure}}
   
This is the same as {\cf read-char}, but does not consume any data
from the port.
\end{entry}

\begin{entry}{%
\rproto{read}{}{procedure}
\proto{read}{ input-port}{procedure}}

Reads an external representation from \var{input-port} using the
transcoder associated with \var{input-port} and returns the datum it
represents.  The {\cf read} procedure operates in the same way as 
{\cf get-datum}, see section~\ref{get-datum}.

If \var{input-port} is omitted, it defaults to the value returned by
{\cf current-input-port}.
\end{entry}

\begin{entry}{%
\proto{write-char}{ char}{procedure}
\rproto{write-char}{ char output-port}{procedure}}

Writes an encoding of the character \var{char} to the port using the
transcoder associated with \var{output-port}. The unspecified value is
returned.

If \var{output-port} is omitted, it defaults to the value returned by
{\cf current-output-port}.
\end{entry}

\begin{entry}{%
\proto{newline}{}{procedure}
\rproto{newline}{ output-port}{procedure}}

This is equivalent to using {\cf write-char} to write {\cf \#linefeed}
to \var{output-port} using the transcoder associated with \var{output-port}.

If \var{output-port} is omitted, it defaults to the value returned by
{\cf current-output-port}.
\end{entry}

\begin{entry}{%
\proto{display}{ obj}{procedure}
\rproto{display}{ obj output-port}{procedure}}

Writes a representation of \var{obj} to the given \var{port} using the
transcoder associated with \var{output-port}.  Strings that appear in
the written representation are not enclosed in doublequotes, and no
characters are escaped within those strings.  Character objects appear
in the representation as if written by {\cf write-char} instead of by
{\cf write}.  {\cf Display} returns the unspecified value.  The
\var{output-port} argument may be omitted, in which case it defaults
to the value returned by {\cf current-output-port}.
\end{entry}

\begin{entry}{%
\proto{write}{ obj}{procedure}
\rproto{write}{ obj output-port}{procedure}}

Writes the external representation of \var{obj} to \var{output-port}
using the transcoder associated with \var{input-port}.  The {\cf write}
procedure operates in the same way as {\cf put-datum}, see
section~\ref{put-datum}.

If \var{output-port} is omitted, it defaults to the value returned by
{\cf current-output-port}.
\end{entry}


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "r6rs"
%%% End: 
