\chapter{Scripts}
\label{scriptappendix}

A \defining{Scheme script} is a top-level program 
(see section~\ref{programchapter}) which is packaged such that 
it is directly executable by conforming implementations of Scheme, on 
one or more plaforms.

\section{Script interpreter}

Implementations should provide a \defining{script interpreter} in 
the form of an executable program named {\cf scheme-script} that is 
capable of initiating the execution of Scheme scripts, as described 
below.

\section{Syntax}

A Scheme script is a delimited piece of text, typically a file, with 
the following syntax:

\begin{grammar}
\meta{script} \: \meta{script header} \meta{toplevel program}
  \> \| \meta{toplevel program}
\meta{script header} \: \meta{shebang} /usr/bin/env \meta{space} 
  \> scheme-script \meta{linefeed}
\meta{shebang} \: \#! \| \#! \meta{space}
%FIXME: script header now optional
\end{grammar}

\subsection{Script header}

The \defining{script header}, if present on the first line of a script,
is used by Unix-like operating systems to identify the interpreter to 
be used to execute that script.

Regardless of platform, Scheme script interpreters should ignore the  
script header if present, and cause the remainder of the script to be 
executed as a Scheme top-level program.

The script header syntax given above is the recommended portable 
form for Unix-like operating systems.  However, if the first line 
of a script begins with {\cf \#!/} or {\cf \#!\meta{space}}, 
implementations must ignore it, even if it does not conform to 
the recommended syntax.  This allows local customizations to be 
performed by altering the script headers from their default form.

\subsection{Example}
\begin{scheme}
\#!/usr/bin/env scheme-script
\#!r6rs
(import (r6rs base)
        (r6rs i/o ports))
(put-bytes (standard-output-port)
           (call-with-port
               (open-file-input-port
                 (cadr (command-line)))
             get-bytes-all))
0
\end{scheme}

\section{Platform considerations}
Many platforms require that scripts be marked as executable in some way. 
The platform-specific details of this are beyond the scope of this 
report.  Scripts that are not suitably marked as executable will fail 
to execute on many platforms.

Other platform-specific notes for some popular operating systems follow.

\subsection{Apple Mac OS X}
The Mac OS X operating system supports the Unix-like script header 
for shell scripts which run in the Terminal.
%TODO: other kind of Mac script?

\subsection{Unix}
Scheme scripts on Unix-like operating systems are supported by the 
presence of the script header.  Scripts which omit the script header 
are unlikely to be directly executable on Unix-like systems.

To support installation of the Scheme script interpreter in 
non-standard paths, scripts should use the {\cf /usr/bin/env} 
program as specified in the recommended script header syntax.  
(Note that on many Unix-like systems, this also allows the 
script interpreter itself to be implemented as a shell script.)

\subsection{Microsoft Windows}
The Windows operating system allows a file extension to be associated 
with a script interpreter such as {\cf scheme-script}.

\subsection{Selecting an implementation}
If multiple implementations of Scheme are installed on a machine, the
user may wish to specify which implementation should be used to 
execute Scheme scripts by default.  Most platforms support some 
mechanism for choosing between alternative implementations of a 
program.  For example, Debian GNU/Linux uses the {\cf /etc/alternatives} 
mechanism to do this; Microsoft Windows uses file extension 
associations.  Implementations are expected to configure this 
appropriately, e.g. as part of their installation procedure.
Failing that, users must perform any necessary configuration to 
choose their preferred Scheme script interpreter.

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "r6rs"
%%% End: 
